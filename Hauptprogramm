import random
import json
import os # Dafür da um zu prüfen ob es ein Speicherstand gibt
class Tamagotchi ():
  def __init__ (self) :

    self.name = ""
    self.gesundheit = 100
    self.hunger = 100
    self.müdigkeit = 0
    self.stimmung = 50 # 0 = traurig/ 100 Mega glücklich
    self.alter = 0
    self.energie = 100
    self.lebens_timer = 0
    self.runden_zaehler_alter = 0
    self.runden_zaehler_gesundheit = 0 
    self.zustand = "gesund"
  def namen_geben (self):
    self.name = input ("Wie möchtest du dein Tamagotchi nennen? ")
  def laden (self):
    if os.path.exists("speichern.json"): #Hier wird geprüft ob es ein Spielstand gibt
      tuen = input("Möchtest du den Spielstand laden? (ja/nein) ").strip().lower()
      if tuen in ["ja","yes","y","j","jap"]:
        with open ("speichern.json", "r") as file:
          daten = json.load(file)
          self.name = daten["name"]
          self.gesundheit = daten["gesundheit"]
          self.hunger = daten["hunger"]
          self.müdigkeit = daten["müdigkeit"]
          self.stimmung = daten["stimmung"] 
          self.alter = daten["alter"]
          self.energie = daten["energie"]
          self.lebens_timer = daten["lebens_timer"]
          self.runden_zaehler_alter = daten["runden_zaehler_alter"]
          self.runden_zaehler_gesundheit = daten["runden_zaehler_gesundheit"] 
          self.zustand = daten["zustand"]
          print("Spielstand erfolgreich geladen")
          self.status_anzeige()
      else:
        print ("Neues Spiel wird gestatet")
    else:
      print("Kein gespeicherter Spielstand gefunden – es wird ein neues Spiel gestartet.")
  def speichern (self):
    speichern = {
      "name" : self.name,
      "gesundheit": self.gesundheit,
      "hunger": self.hunger,
      "müdigkeit": self.müdigkeit,
      "stimmung": self.stimmung,
      "alter": self.alter,
      "energie": self.energie,
      "lebens_timer": self.lebens_timer,
      "runden_zaehler_alter": self.runden_zaehler_alter,
      "runden_zaehler_gesundheit": self.runden_zaehler_gesundheit,
      "zustand": self.zustand}
    with open ("speichern.json", "w") as file:
      json.dump(speichern, file, indent=2)
  #Hier schaltet man den Arztbesuch frei, wenn man den Zustand krank oder den zustand verletzt hat.      Ist Fertig und funktioniert
  def Arzt(self):
    zufallzahl = random.randint (1,100)
    if self.zustand == "krank" or self.zustand == "verletzt":
      print(f"{self.name} ist immer noch {self.zustand}.")
      arztbesuch = input ("Willst du mit Ihm zum Arzt? ja/nein ").strip().lower()
      if arztbesuch == "ja":
        if zufallzahl <= 80:
          self.zustand = "gesund"
          self.gesundheit += 30
          self.stimmung += 20
          print(f"{self.name} geht es wieder super. Der Artz besuch hat geholfen.")
        else:
          print(f"Der Arzt besuch hat wohl nicht geholfen. {self.name} ist immer noch {self.zustand}.")
  #Hier werden die Zustände vergeben nach einer bestimmten zeit
  def zufallsereignis(self):
    # Ereignisse und ihre Gewichtung
    ereignisse = {"krank": 10, "verletzt":10,"freudig":50, "langweilig":30 }
    ereignis = random.choices(list(ereignisse.keys()), weights=list(ereignisse.values()), k=1)[0]
    # Hier ist die Option, wenn das Tamagotchi älter wird ändern sich die wahrscheinlichkeiten.
    if self.alter > 10:
      #Hier kommt noch der zustand ruhe hinzu
      ereignisse ["ruhe"] = 10
      ereignisse ["krank"] = 20
      ereignisse ["verletzt"] = 20
      ereignisse ["freudig"] = 30
      ereignisse ["langweilig"] = 10

    elif self.alter > 5:
      del ereignisse ["langweilig"]
      ereignisse ["ruhe"] = 20
      ereignisse ["krank"] = 30
      ereignisse ["verletzt"] = 30
      ereignisse ["freudig"] = 20

    if self.zustand == "gesund" and self.runden_zaehler_alter == 4:
      if ereignis == "krank":
        self.gesundheit -= 20
        self.stimmung -= 10
        print(f"{self.name} ist krank geworden")
        self.zustand = "krank" 
        # Hie bekommt man den zustand verletzt
      elif ereignis == "verletzt":
        self.gesundheit -= 15
        print(f"{self.name} hat sich beim spielen verletzt")
        self.zustand = "verletzt"
        # Hier bekommt man den zustand freudig.
      elif ereignis == "freudig":
        self.stimmung += 20
        self.energie -= 10
        print (f"{self.name} ist einfach Glücklich")
        self.zustand = "freudig"
      elif ereignis == "langweilig":
        self.stimmung -= 10
        self.energie -= 10
        print (f"{self.name} ist langweilig")
      elif ereignis == "ruhe":
        self.energie += 15
        print(f"{self.name} entspannt sich.")
  # Ist der Interne Rundezähler im vom Tamagotchi um Sachen zu erhöhen oder zu reduzieren Ist fertig und Funktioniert
  def älter_werden(self):
    self.runden_zaehler_alter += 1
    if self.runden_zaehler_alter == 5:
      self.runden_zaehler_alter = 0
      self.alter += 1
      print (f"{self.name} ist ein Tag älter geworden.")
  # Das soll nur dafür da sein damit keiner der Statuswerte über oder unter 0 oder 100 geht.
  def statuswert_nicht_unter_0_nicht_über_100 (self):
    if self.gesundheit < 0:
      self.gesundheit = 0
    if self.gesundheit >= 100:
      self.gesundheit = 100
    if self.hunger < 0:
      self.hunger = 0
    if self.hunger >=100:
      self.hunger = 100
    if self.müdigkeit < 0:
      self.müdigkeit = 0
    if self.müdigkeit >= 100:
      self.müdigkeit = 100
    if self.stimmung < 0:
      self.stimmung = 0
    if self.stimmung >= 100:
      self.stimmung = 100
    if self.energie < 0 :
      self.energie = 0
    if self.energie >= 100:
      self.energie = 100
  # Wenn ein bestimmter wert eventuell stimmung 3 Runden lang unter Null ist und Gesundheit 3 Runden lang unter Null ist tot. Funktioniert
  def tot (self):
     #Das hier ist nur ein Test, später löschen
    if self.gesundheit == 0:
      self.lebens_timer += 1
      if self.lebens_timer >= 2:
        print (f"{self.name} ist tot")
        return True
    else:
      self.lebens_timer = 0
      return False
  #Hier wird die Gesundheit gesenkt.
  def gesundheit_senkung(self):
    self.runden_zaehler_gesundheit += 1
    if self.runden_zaehler_gesundheit == 3 and self.stimmung <= 50:
      self.gesundheit -= 10
      self.runden_zaehler_gesundheit = 0
    elif self.runden_zaehler_gesundheit == 3:
      self.gesundheit -= 5
      self.runden_zaehler_gesundheit = 0
  #Alle 2 Runden Hunger dazu.
  def hunger_bekommen (self):
    if self.runden_zaehler_gesundheit == 2:
      self.hunger += 10
    #Eventuell später die funktion Arzt einbauen. Wenn Gesundheit bei 0 ist.
  #Um Müdigkeit zu senken und Energie zu bekommen. Mit auch Zuständen.
  def schlafen(self):
    zufall_text = random.randint (1,10)
    if self.zustand == "krank" or self.zustand == "verletzt":
      print(f"{self.name} hat der Schlaf gut getan, aber er ist immer noch {self.zustand}.")
      self.müdigkeit -= 30
      self.energie += 10
      self.gesundheit += 10
      # Hier ist das Tamagotich nicht müde und schläft nicht und seine stimmung nimmt ab
    elif self.müdigkeit <= 25:
      self.stimmung -= 10
      if zufall_text <= 7:
        print(f"{self.name} ist nicht Müde und will noch nicht schlafen.")
      else:
        print(f"{self.name} schreit ist wüten" )
        self.stimmung -= 10
      #Hier schläft er wiederwillig. Müdigkeit geht nur langsam runt dafür die Stimmung auch
    elif self.müdigkeit <=50:
      print(f"{self.name} ist nicht wirklich müde.")
      print("brrrrBrrrrbrrrr")
      self.müdigkeit -= 10
      self.stimmung -=10
      # Er ist erledigt und schläft ein
    else:
      self.müdigkeit -= 30
      self.energie += 15
      print(f"{self.name} ist müde und schläft ein." )
      print("ZzzzzZzzzzZzzzz")
  # Um Hunger zu reduzieren
  def essen(self):
    if self.zustand == "verletzt" or self.zustand == "krank":
      print(f"{self.name} braucht das Essen wirklich, aber er ist immer noch{self.zustand}." )
    # Hat Großen Hunger.
    elif self.hunger >= 70:
      self.hunger -= 40
      self.stimmung += 20
      self.energie += 20
      print(f"{self.name} isst sich richtig Satt und ist Glücklich." )
      # Es geht so mit dem Hunger
    elif self.hunger >= 50:
      self.hunger -= 20
      self.stimmung += 10
      self.energie += 10
      # Es zwingt sich zum Essen was nicht gesund ist
    elif self.hunger >= 30:
      self.hunger -= 10
      print (f"{self.name} ist nicht hungrig, aber für dich drückt er sich das essen noch rein.")
      self.stimmung -= 10
      self.gesundheit -= 10
      # Er will nichts essen
    else:
      print(f"{self.name} ist nicht hungrig!")
      self.stimmung -= 20
  # Glücklichkeit steigern Energier Reduzieren. Müdigkeit erhöhen
  def spielen(self):
    zufall_text = random.randint (1,3)
    #Hier passieren die Sachen, wenn man verletzt ist und trotzdem spielt.
    if self.zustand == "verletzt":
      if zufall_text <=2:
        print(f"{self.name} tut sich richtig weh beim Spielen")
        self.gesundheit -= 40
        self.energie -= 30
        self.stimmung -= 20
      else:
        print (f" Noch einmal glück gehabt. Was hätte {self.name} sich verletzt" )
        self.energie -= 40
        self.müdigkeit += 10
    # Hier passieren die Sachen, wenn man krank ist und trotzdem spielt
    elif self.zustand == "krank":
      if zufall_text == 1 :
        print(f"{self.name} fühlt sich nicht gut.")
      elif zufall_text == 2 :
        print(f"{self.name} übergibt sich.")
      elif zufall_text == 3 :
        print(f"{self.name} bricht zusammen.")
      self.gesundheit -= 30
      self.energie -= 10
      self.stimmung -= 20
    # Hier passieren Sachen wenn man freudig ist und spielt oder langeweile hat
    elif self.zustand == "freudig" or self.zustand == "langweilig":
      self.zustand = "gesund"
      self.gesundheit += 20
      self.stimmung += 40
      self.energie -=10
      self.müdigkeit += 10
      if zufall_text == 1:
        print(f"Wooohooo! {self.name} ist total glücklich!")
      elif zufall_text == 2:
        print(f"Toll! {self.name} ist voller Energie!")
      else:
        print(f"Super! {self.name} hat richtig viel Spaß!")

    elif self.energie >= 70:
      if zufall_text == 1 :
        print(f"{self.name} hat großen Spaß mit dir und freut sich einfach.")
      elif zufall_text == 2 :
        print(f"{self.name} spielt gerne mit dir.")
      elif zufall_text == 3 :
        print(f"{self.name} verbringt gerne Zeit mit dir.")
      self.energie -= 30
      self.müdigkeit += 10
      self.hunger += 10
      self.gesundheit += 20
    elif self.energie >= 50:
      self.energie -= 30
      self.müdigkeit += 20
      self.hunger += 20
      self.gesundheit += 20
      print(f"{self.name} hat  Spaß ist, aber doch erledigt.")
    else: 
      self.energie -= 30
      self.müdigkeit += 40
      self.hunger += 30
      self.gesundheit -= 20
      print(f"{self.name} hat  sich beim Spielen verletzt") 
      self.zustand = "verletzt"
  # Glücklichkeit erhöhen Müdigkeit eröhen
  def streicheln(self):
    # Hier bauen wir eine Wahrscheinlickeit ein ob das Tamagotich sich im krankheitszustand darüber freut oder nicht
    zufall_text = random.randint (1,10)
    if self.zustand == "krank" and zufall_text <= 7:
      self.stimmung += 10
      self.müdigkeit += 20
      self.gesundheit += 10
      print (f"{self.name} ist glücklich, dass du für ihn da bist.") 
    elif self.zustand == "krank" and zufall_text <= 10:
      print (f"{self.name} geht´s richtig schlecht.") 
      self.stimmung -= 10
      self.müdigkeit -= 10
      self.gesundheit -= 5
    elif self.zustand == "verletzt" and zufall_text <= 8:
      print (f"Das streicheln lässt {self.name} die Verletzung vergessen." )
      self.stimmung += 10
      self.müdigkeit += 10
      self.gesundheit += 20
    elif self.zustand == "verletzt" and zufall_text <= 10:
      print (f"{self.name} tut alles weh." )
      self.stimmung -= 10
      self.müdigkeit -= 10
      self.gesundheit -= 10
    elif zufall_text >= 5:
      self.stimmung += 10
      self.müdigkeit += 20
      print(f"{self.name} freut sich über die Streicheleinheit von dir.") 
    else:
      self.stimmung += 10
      self.müdigkeit += 20
      print(f"{self.name} ist sehr entspannt. ") 
  # Hier werden die Statuswerte angezeigt
  def status_anzeige(self):
    print(f"Statuswerte von {self.name}: ")
    print (f"Gesundheit: {self.gesundheit} ")
    print (f"Energie: {self.energie} ")
    print (f"Müdigkeit: {self.müdigkeit} ")
    print (f"Hunger: {self.hunger} ")
    print (f"Stimmung: {self.stimmung} ")
    print (f"Zustand: {self.zustand} ")
    print(f"Alter: {self.alter} {'Tag' if self.alter == 1 else 'Tage'}")   
# Hier wird alles für das Programm eingefügt
  def start(self):
    #Hier wird geprüft ob es ein Speicherstand gibt, wenn ja wird dieser gefragt ob er den Laden will.
    
    richtige_eingabe = False
    while not richtige_eingabe:
      print(f"Was möchtest du mit {self.name} machen? ")
      tuen = input("Schlafen/Essen/Spielen/Streicheln/Status/Speichern ").strip().lower()
      if tuen == "schlafen":
        richtige_eingabe = True
        self.schlafen()
      elif tuen == "essen":
        richtige_eingabe = True
        self.essen()
      elif tuen == "spielen":
        richtige_eingabe = True
        self.spielen()
      elif tuen == "streicheln":
        richtige_eingabe = True
        self.streicheln()
      elif tuen == "status":
        richtige_eingabe = True
        self.status_anzeige()
      elif tuen == "speichern":
        richtige_eingabe = True
        self.speichern()
        break
      else: 
        print("Deine Eingabe ist Fehlerhaft!")
    if self.stimmung == 0:
        print("ROAR")
        print (f"{self.name} ist mega wütend. Tue was dagegen")
      #Gesundheit senken durch Wut.
        self.gesundheit -= 20
    self.älter_werden()
    self.gesundheit_senkung()
    self.zufallsereignis()
    self.Arzt()
    self.hunger_bekommen()
    self.statuswert_nicht_unter_0_nicht_über_100()
  def begrüssung (self):
    print(f"{self.name} ist ein guter Name. Kümmer dich gut um {self.name}.")
# Hauptspiel
def main():
    print("Hallo und Herzlich Willkommen bei meinem Tamagotchi Projekt")
    tamagotchi1 = Tamagotchi()
    tamagotchi1.namen_geben()
    tamagotchi1.begrüssung()
    tamagotchi1.laden()
    while True:
        tamagotchi1.start() #Aufruf der Start-Methode für das Tamagotchi
        if  tamagotchi1.tot(): # Beendet das Spiel, wenn der Tamagotch tot ist.
          break
main()
